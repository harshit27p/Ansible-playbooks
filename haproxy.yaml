---
 - name: configure haproxy
   hosts: serverc
   tasks:
     - name: install haproxy
       yum:
         name: haproxy
         state: present

     - name: manage service
       service:
         name: haproxy.service
         state: started
         enabled: yes

     - name: add 80/tcp to firewall
       firewalld:
         port: 80/tcp
         permanent: true
         immediate: true
         state: enabled

     - name: copy haproxy conf file
       copy:
         src: ./haproxy.conf
         dest: /etc/haproxy/haproxy.cfg

       notify: restarted

   handlers:
    - name: restarted
      service:
        name: haproxy.services
        state: restarted
